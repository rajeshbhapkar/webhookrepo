pipeline {
    agent any
    stages {
       stage("build")
       {    
           steps
           {  
               script {
                      echo "INFO: Building docker image"
                      sh "docker build -t index.php-demo:latest"
                      echo "INFO: Docker image built"
               }     
           }
       } 
       stage("Deploy")
       {
           steps
           {
                script {
                       echo "INFO: RUNNING new docker image"
                       sh "docker rm -f index.php demo || true"
                       sh "docker run --restart always -p 7272:7272 -d --name index.php-demo-container index.php-demo:latest"
                       echo "INFO: Deployed"
                }
            }
        }              
    }
    
